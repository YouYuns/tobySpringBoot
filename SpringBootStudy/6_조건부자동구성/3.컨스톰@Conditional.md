## âœ… @ì»¤ìŠ¤í†° @Conditional

### ğŸ’¡ ë¬´ì—‡ì„ ê¸°ì¤€ìœ¼ë¡œ Tomcatê³¼ Jettyì„ ë„ìš¸ê¹Œ? 
 - ìŠ¤í”„ë§ë¶€íŠ¸ê°€ ìë™êµ¬ì„±ì—ì„œ ê°€ì¥ ëŒ€í‘œì ìœ¼ë¡œ ì“°ì´ëŠ” ë°©ë²•ì€ ì–´ë–¤ ë¼ì´ë¸ŒëŸ¬ë¦¬ê°€ ì´í”„ë¡œì íŠ¸ì— í¬í•¨ë˜ì–´ìˆëŠ”ê°€ ì²´í¬í•´ë³¸ë‹¤.
 - ì–´ë–¤ í´ë˜ìŠ¤ê°€ (Tomcat Class, Server(Jettyì˜ ì´ë¦„) Class) ìˆëŠ”ì§€ ì°¾ì•„ì„œ ê·¸ê²ƒì„ ê¸°ì¤€ìœ¼ë¡œ ì„œë²„ë¥¼ ë„ìš°ë©´ëœë‹¤.
 - ì–´ë–¤ í´ë˜ìŠ¤ê°€ ì´ í”„ë¡œì íŠ¸ì— í¬í•¨ë˜ì–´ì ¸ìˆëŠ”ê°€? ì°¾ì•„ë³´ì


![img_1.png](img_1.png)

### ğŸ“Œ ClassUtiles.isPresent() ì´ëŸ° ì´ë¦„ì˜ í´ë˜ìŠ¤ê°€ ì¡´ì¬í•˜ëŠ”ê°€ ì•Œì•„ë³´ëŠ” ë©”ì„œë“œ 
 - í†°ìº£ì´ë¼ëŠ” í´ë˜ìŠ¤ê°€ í˜„ì¬ í”„ë¡œì íŠ¸ì— í¬í•¨ì´ ë˜ì–´ì ¸ìˆìœ¼ë©´ trueë¦¬í„´ ë¹ˆ ì˜¤ë¸Œì íŠ¸ë¡œ ë“±ë¡ë˜ì–´ì„œ ì‚¬ìš©ë˜ê²Œí•˜ëŠ”ê²ƒì´ë‹¤.
```java
import com.example.config.autoconfig.TomcatWebServerConfig;
import com.fasterxml.jackson.databind.util.ClassUtil;
import org.springframework.util.ClassUtils;

@MyAutoConfiguration
@Conditional(TomcatWebServerConfig.TomcatCondition.class)
public class JettyWebServerConfig {
    @Bean("jettyWebServerFactory")
    public ServletWebServerFactory servletWebServerFactory() {
        return new JettyServletWebServerFactory();
    }

    static class TomcatCondition implements Condition {
        @Override
        public boolean matches(ConditionContext context, AnnotatedTypeMetadata metadata) {
            return ClassUtils.isPresent("org.apache.catalina.startup.Tomcat", context.getClassLoader());
        }
    }

}
```

### ğŸ“Œ ë§ˆì°¬ê°€ì§€ë¡œ Jettyì„œë²„ì—ë„ ì¶”ê°€
 - ì‹¤í–‰ì„ í•´ë³´ë©´ Multipleë¼ì´ë¸ŒëŸ¬ë¦¬ë¼ëŠ” ì—ëŸ¬ê°€ ë°œìƒí•œë‹¤, ë‘˜ë‹¤ ë“±ë¡ì´ ë˜ì–´ì ¸ìˆìœ¼ë¯€ë¡œ í•´ë‹¹ ì˜¤ë¥˜ê°€ ë°œìƒ
 - dependenciesì— í•´ë‹¹ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì£¼ì„ì²˜ë¦¬í•˜ê±°ë‚˜í•˜ë©´ ëœë‹¤.


### ğŸ’¡ ê·¼ë° Jettyì™€ Tomcatêµ¬ì„±í•˜ëŠ”ê²Œ ë„ˆë¬´ ë¹„ìŠ·í•´ì„œ ë¦¬íŒ©í† ë§ì´ í•„ìš”í•˜ë‹¤
 - ê·¸ í•œê°œì˜ ë°©ë²•ì¤‘ ë©”íƒ€ì• ë…¸í…Œì´ì…˜ì„ ë§Œë“œëŠ”ê²ƒì´ë‹¤.
 - ê·¸ê²Œ ì»¤ìŠ¤í†° @Conditionalì¸ë° ë§Œë“¤ì–´ë³´ì

1. ì»¤ìŠ¤í…€ ì• ë…¸í…Œì´ì…˜ì„ ë§Œë“œëŠ” ì£¼ìš” ì´ìœ  :  ì»¨í‹°ì…˜ì—ì„œ ì½ì–´ê°ˆìˆ˜ìˆëŠ” Elementsê°’ì„ ì£¼ê¸°ìœ„í•´ì„œì´ë‹¤.

```java
import org.springframework.context.annotation.ConditionContext;
import org.springframework.core.type.AnnotatedTypeMetadata;
import org.springframework.util.ClassUtils;

import java.lang.annotation.ElementType;
import java.lang.annotation.Retention;
import java.lang.annotation.RetentionPolicy;
import java.lang.annotation.Target;
import java.util.Objects;
import java.util.concurrent.locks.Condition;

@Retention(RetentionPolicy.RUNTIME)
@Target({ElementType.TYPE, ElementType.METHOD})
@Conditional(MyOnClassCondition.class)
public @interface ConditionalMyOnClass {
    String value();
}


public class MyOnClassCondition implements Condition {
    public boolean matches(ConditionContext context, AnnotatedTypeMetadata metadata) {
        Map<String, Objects> attrs = metadata.getAnnotationAttributes(ConditionalMyOnClass.class.getName());
        String value = (String) attrs.get("value");
        return ClassUtils.isPresent(value, context.getClassLoader());
    }
}
```

2. ì´ë ‡ê²Œ ì• ë…¸í…Œì´ì…˜ì„ ë§Œë“¤ê²Œë˜ë©´ ê³µí†µì ìœ¼ë¡œ ë§Œë“¤ì–´ë†“ê²Œë˜ì–´ì„œ ì¶”ìƒí™”ë¥¼ í•´ë†“ëŠ”ê²Œ ì¢‹ë‹¤
 - ë‹¤ìŒê³¼ ê°™ì´ ì½”ë“œê°€ ë°”ë€Œê²Œ ëœë‹¤.
```java
@MyAutoConfiguration
@Conditional("org.apache.catalina.startup.Tomcat")
public class JettyWebServerConfig {
    @Bean("jettyWebServerFactory")
    public ServletWebServerFactory servletWebServerFactory() {
        return new JettyServletWebServerFactory();
    }


}
```


